<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</title>

<style>
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: #f4f6f9;
}

/* ===== Header ===== */
header {
  background: #0d6efd;
  color: #fff;
  padding: 14px;
  text-align: center;
}

#version {
  font-size: 12px;
  opacity: 0.8;
}

/* ===== Layout ===== */
main {
  padding: 12px;
}

.card {
  background: #fff;
  border-radius: 12px;
  padding: 12px;
  margin-bottom: 12px;
}

/* ===== Form ===== */
input, select, button {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  font-size: 14px;
}

button {
  background: #0d6efd;
  color: #fff;
  border: none;
  border-radius: 8px;
}

/* ===== Records ===== */
.record {
  display: flex;
  justify-content: space-between;
  font-size: 14px;
  padding: 6px 0;
  border-bottom: 1px solid #eee;
  cursor: pointer;
}

.income { color: #0d6efd; }
.expense { color: #dc3545; }

.highlight {
  background: yellow;
}

/* ===== Update Bar ===== */
#updateBar {
  position: fixed;
  bottom: -60px;
  left: 0;
  right: 0;
  background: #198754;
  color: #fff;
  text-align: center;
  padding: 12px;
  transition: .4s;
}
#updateBar.show {
  bottom: 0;
}

/* ===== PIN ===== */
#pinLock {
  position: fixed;
  inset: 0;
  background: #111;
  color: #fff;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.pin-dots {
  letter-spacing: 10px;
  font-size: 32px;
}

.keypad {
  display: grid;
  grid-template-columns: repeat(3, 80px);
  gap: 10px;
  margin-top: 20px;
}

.keypad button {
  height: 60px;
  font-size: 20px;
  border-radius: 10px;
}
</style>
</head>

<body>

<header>
  üìä ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
  <div id="version">Version 1.3.1</div>
</header>

<main>

<div class="card">
  <input type="date" id="date">
  <input type="text" id="title" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£">
  <input type="number" id="amount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">
  <select id="type">
    <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
    <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
  </select>
  <button onclick="addRecord()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
</div>

<div class="card">
  <input type="text" id="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." oninput="render()">
</div>

<div class="card" id="list"></div>

<div class="card">
  <button onclick="backup()">üì§ Backup</button>
  <button onclick="restore()">üì• Restore</button>
</div>

<div class="card">
  <h3>üìå Changelog</h3>
  <ul>
    <li>1.3.1 ‚Äì ‡∏£‡∏∞‡∏ö‡∏ö Update ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</li>
    <li>1.3.0 ‚Äì ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ + ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ï‡πå</li>
    <li>1.2.0 ‚Äì PIN Lock</li>
  </ul>
</div>

</main>

<div id="updateBar">üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà...</div>

<!-- ===== PIN LOCK ===== -->
<div id="pinLock" style="display:none">
  <div class="pin-dots" id="dots">____</div>
  <div class="keypad"></div>
</div>

<script>
/* ===== DATA ===== */
const records = JSON.parse(localStorage.getItem("records") || "[]");
const PIN_KEY = "pinCode";

/* ===== RECORDS ===== */
function addRecord() {
  records.push({
    date: date.value,
    title: title.value,
    amount: +amount.value,
    type: type.value
  });
  localStorage.setItem("records", JSON.stringify(records));
  render();
}

function render() {
  const q = search.value.toLowerCase();
  list.innerHTML = "";
  records
    .filter(r => r.title.toLowerCase().includes(q))
    .forEach(r => {
      let t = r.title.replace(q, `<span class="highlight">${q}</span>`);
      list.innerHTML += `
        <div class="record ${r.type}">
          <span>${r.date} ${t}</span>
          <span>${r.amount}</span>
        </div>`;
    });
}

/* ===== BACKUP ===== */
function backup() {
  const blob = new Blob([JSON.stringify(localStorage)], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "backup.json";
  a.click();
}

function restore() {
  const i = document.createElement("input");
  i.type = "file";
  i.onchange = e => {
    const r = new FileReader();
    r.onload = () => {
      const data = JSON.parse(r.result);
      for (let k in data) localStorage.setItem(k, data[k]);
      location.reload();
    };
    r.readAsText(e.target.files[0]);
  };
  i.click();
}

/* ===== PIN ===== */
let pin = "";
const lock = document.getElementById("pinLock");
if (localStorage.getItem(PIN_KEY)) lock.style.display="flex";

function buildPad() {
  const pad = document.querySelector(".keypad");
  pad.innerHTML="";
  [...Array(10).keys()].forEach(n=>{
    const b=document.createElement("button");
    b.textContent=n;
    b.onclick=()=>press(n);
    pad.appendChild(b);
  });
}
buildPad();

function press(n) {
  pin+=n;
  dots.textContent = pin.padEnd(4,"_");
  if (pin.length===4) {
    if (pin===localStorage.getItem(PIN_KEY)) lock.style.display="none";
    pin="";
    dots.textContent="____";
  }
}

/* ===== SERVICE WORKER ===== */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
  navigator.serviceWorker.addEventListener("controllerchange",()=>{
    updateBar.classList.add("show");
    setTimeout(()=>location.reload(),1500);
  });
}

render();
</script>

</body>
</html>
