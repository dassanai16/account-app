<!DOCTYPE html>
<html lang="th">
<head>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0d6efd">


<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</title>

<style>
body{margin:0;font-family:system-ui,sans-serif;background:#f4f6f9}
header{background:#0d6efd;color:#fff;padding:14px;text-align:center}
#version{font-size:12px;opacity:.8}
main{padding:12px}
.card{background:#fff;border-radius:12px;padding:12px;margin-bottom:12px}
input,select,button{width:100%;padding:10px;margin-top:6px;font-size:14px}
button{background:#0d6efd;color:#fff;border:none;border-radius:8px}
.record{display:flex;justify-content:space-between;font-size:14px;padding:6px 0;border-bottom:1px solid #eee}
.income{color:#0d6efd}
.expense{color:#dc3545}
.highlight{background:yellow}

/* PIN */
#pinLock{
  position:fixed;inset:0;background:#111;color:#fff;
  display:flex;flex-direction:column;justify-content:center;align-items:center;
  z-index:999
}
.pin-dots{font-size:32px;letter-spacing:10px}
.keypad{display:grid;grid-template-columns:repeat(3,80px);gap:10px;margin-top:20px}
.keypad button{height:60px;font-size:20px;border-radius:10px}
</style>
</head>

<body>

<header>
  üìä ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
  <div id="version">Version 1.5.0</div>
</header>

<main>

<div class="card">
  <input type="date" id="date">
  <input type="text" id="title" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£">
  <input type="number" id="amount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">
  <select id="type">
    <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
    <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
  </select>
  <button onclick="addRecord()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
</div>

<div class="card">
  <input type="text" id="search" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." oninput="render()">
</div>

<div class="card" id="list"></div>

<div class="card">
  <button onclick="showSummary()">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
  <button onclick="backup()">üì§ Backup</button>
  <button onclick="restore()">üì• Restore</button>
  <button onclick="exportExcel()">üìä Export Excel</button>
</div>

</main>

<!-- PIN LOCK -->
<div id="pinLock">
  <div id="pinTitle">‡∏ï‡∏±‡πâ‡∏á PIN 4 ‡∏´‡∏•‡∏±‡∏Å</div>
  <div class="pin-dots" id="dots">____</div>
  <div class="keypad"></div>
</div>

<script>
/* ===== DATA (‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î) ===== */
const records = JSON.parse(localStorage.getItem("records") || "[]");
const PIN_KEY = "pinCode";

/* ===== RECORD ===== */
function addRecord(){
  records.push({
    date:date.value,
    title:title.value,
    amount:+amount.value,
    type:type.value
  });
  localStorage.setItem("records",JSON.stringify(records));
  render();
}

function render(){
  const q = search.value.toLowerCase();
  list.innerHTML="";
  records
    .sort((a,b)=>a.date.localeCompare(b.date))
    .filter(r=>r.title.toLowerCase().includes(q))
    .forEach(r=>{
      let t=r.title;
      if(q){
        t=t.replace(new RegExp(q,"gi"),m=>`<span class="highlight">${m}</span>`);
      }
      list.innerHTML+=`
        <div class="record ${r.type}">
          <span>${r.date} ${t}</span>
          <span>${r.amount}</span>
        </div>`;
    });
}

/* ===== SUMMARY ===== */
function showSummary(){
  let income=0, expense=0;
  records.forEach(r=>{
    if(r.type==="income") income+=r.amount;
    if(r.type==="expense") expense+=r.amount;
  });
  const balance = income-expense;
  alert(
    "üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n\n"+
    "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö: "+income.toLocaleString()+"\n"+
    "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢: "+expense.toLocaleString()+"\n"+
    "‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: "+balance.toLocaleString()
  );
}

/* ===== BACKUP / RESTORE ===== */
function backup(){
  download(
    new Blob([JSON.stringify(localStorage)],{type:"application/json"}),
    "backup.json"
  );
}

function restore(){
  const i=document.createElement("input");
  i.type="file";
  i.onchange=e=>{
    const r=new FileReader();
    r.onload=()=>{
      const data=JSON.parse(r.result);
      for(let k in data) localStorage.setItem(k,data[k]);
      location.reload();
    };
    r.readAsText(e.target.files[0]);
  };
  i.click();
}

/* ===== EXPORT EXCEL ===== */
function exportExcel(){
  let html="<table><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th></tr>";
  records.forEach(r=>{
    html+=`<tr><td>${r.date}</td><td>${r.title}</td><td>${r.amount}</td><td>${r.type}</td></tr>`;
  });
  html+="</table>";
  download(
    new Blob(['\ufeff'+html],{type:"application/vnd.ms-excel"}),
    "records.xls"
  );
}

function download(blob,name){
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=name;
  a.click();
}

/* ===== PIN LOCK ===== */
const pinLock=document.getElementById("pinLock");
const dots=document.getElementById("dots");
const pinTitle=document.getElementById("pinTitle");
let pin="";
const savedPIN=localStorage.getItem(PIN_KEY);
let mode=savedPIN?"unlock":"setup";
pinTitle.textContent = mode==="setup"?"‡∏ï‡∏±‡πâ‡∏á PIN 4 ‡∏´‡∏•‡∏±‡∏Å":"‡πÉ‡∏™‡πà PIN";

function buildPad(){
  const pad=document.querySelector(".keypad");
  pad.innerHTML="";
  for(let i=1;i<=9;i++) addBtn(i);
  addBtn(0);
}
function addBtn(n){
  const b=document.createElement("button");
  b.textContent=n;
  b.onclick=()=>press(n);
  document.querySelector(".keypad").appendChild(b);
}
buildPad();

function press(n){
  pin+=n;
  dots.textContent=pin.padEnd(4,"_");
  if(pin.length===4){
    if(mode==="setup"){
      localStorage.setItem(PIN_KEY,pin);
      alert("‡∏ï‡∏±‡πâ‡∏á PIN ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
      pinLock.style.display="none";
    }else{
      if(pin===savedPIN){
        pinLock.style.display="none";
      }else{
        alert("PIN ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
      }
    }
    pin="";
    dots.textContent="____";
  }
}

render();
</script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("./sw.js");
}
</body>
</html>
