<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‚Äì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</title>
<link rel="manifest" href="manifest.json">

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    background: #f1f3f6;
    margin: 0;
    padding: 10px;
}
.container {
    max-width: 430px;
    margin: auto;
    background: #fff;
    padding: 14px;
    border-radius: 14px;
}
h2 { text-align: center; }

input, select, button {
    width: 100%;
    padding: 12px;
    margin-top: 8px;
    border-radius: 10px;
    border: 1px solid #ccc;
    font-size: 16px;
}

button { border: none; cursor: pointer; }
.add { background: #007aff; color: white; }
.sum { background: #34c759; color: white; }

.summary {
    display: none;
    background: #eef6ff;
    margin-top: 10px;
    padding: 10px;
    border-radius: 10px;
}

.item {
    background: #fafafa;
    padding: 10px;
    border-radius: 10px;
    margin-top: 8px;
    display: flex;
    gap: 8px;
}

.left {
    flex: 1;
    word-break: break-word;
    line-height: 1.4;
}

.amount {
    white-space: nowrap;
    font-weight: bold;
}
.income { color: #007aff; }
.expense { color: #e74c3c; }

.actions button {
    font-size: 12px;
    padding: 4px 6px;
    border-radius: 6px;
    margin-left: 4px;
}
.edit { background: #f1c40f; }
.del { background: #ff3b30; color: #fff; }

/* ‚úÖ Popup */
.popup {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.5);
    display: none;
    align-items: center;
    justify-content: center;
}
.popup-box {
    background: white;
    width: 90%;
    max-width: 350px;
    padding: 16px;
    border-radius: 14px;
}
.popup-box h3 { margin-top: 0; }
.close {
    background: #007aff;
    color: white;
    margin-top: 10px;
}
</style>
</head>

<body>
<div class="container">
<h2>üìí ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‚Äì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h2>

<select id="month"></select>
<input type="date" id="date">
<input id="item" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£">
<input type="number" id="amount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">
<select id="type">
    <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
    <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
</select>

<button class="add" onclick="save()">‚ûï ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
<button class="sum" onclick="toggleSummary()">üìä ‡∏™‡∏£‡∏∏‡∏õ</button>

<div class="summary" id="summary">
    ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö: <span id="i">0</span><br>
    ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢: <span id="e">0</span><br>
    <strong>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <span id="b">0</span></strong>
</div>

<div id="list"></div>
</div>

<!-- ‚úÖ Popup -->
<div class="popup" id="popup" onclick="closePopup()">
<div class="popup-box" onclick="event.stopPropagation()">
<h3>üìÑ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h3>
<div id="detail"></div>
<button class="close" onclick="closePopup()">‡∏õ‡∏¥‡∏î</button>
</div>
</div>

<script>
let db = JSON.parse(localStorage.getItem("acc")) || {};
let editIndex = null;

const months = ["2025-12", ...Array.from({length:12},(_,i)=>`2026-${String(i+1).padStart(2,"0")}`)];
month.innerHTML = months.map(m=>{
    const d = new Date(m+"-01");
    return `<option value="${m}">${d.toLocaleString("th-TH",{month:"long",year:"numeric"})}</option>`;
}).join("");

date.value = new Date().toISOString().slice(0,10);

function save(){
    const m = month.value;
    const r = {
        date: date.value,
        item: item.value,
        amount: Number(amount.value),
        type: type.value
    };
    if(!r.date||!r.item||!r.amount) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");

    db[m] = db[m] || [];
    editIndex === null ? db[m].push(r) : db[m][editIndex]=r;
    editIndex = null;

    localStorage.setItem("acc",JSON.stringify(db));
    item.value = amount.value = "";
    render();
}

function render(){
    let inc=0, exp=0;
    const m = month.value;
    const arr = (db[m]||[]).sort((a,b)=>new Date(a.date)-new Date(b.date));

    list.innerHTML = arr.map((d,i)=>{
        d.type==="income"?inc+=d.amount:exp+=d.amount;
        return `
        <div class="item" onclick="view(${i})">
            <div class="left">${d.date} | ${d.item}</div>
            <div class="amount ${d.type}">
                ${d.type==="income"?"+":"-"}${d.amount}
            </div>
            <div class="actions">
                <button class="edit" onclick="event.stopPropagation();edit(${i})">‚úèÔ∏è</button>
                <button class="del" onclick="event.stopPropagation();del(${i})">üóë</button>
            </div>
        </div>`;
    }).join("");

    i.innerText = inc;
    e.innerText = exp;
    b.innerText = inc-exp;
    b.style.color = inc-exp<0?"#e74c3c":"#000";
}

function view(i){
    const d = db[month.value][i];
    detail.innerHTML = `
    ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${d.date}<br>
    ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ${d.item}<br>
    ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${d.amount}<br>
    ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${d.type==="income"?"‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö":"‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢"}
    `;
    popup.style.display="flex";
}

function closePopup(){ popup.style.display="none"; }

function edit(i){
    const d = db[month.value][i];
    date.value=d.date; item.value=d.item; amount.value=d.amount; type.value=d.type;
    editIndex=i;
}

function del(i){
    if(confirm("‡∏•‡∏ö?")){
        db[month.value].splice(i,1);
        localStorage.setItem("acc",JSON.stringify(db));
        render();
    }
}

function toggleSummary(){
    summary.style.display = summary.style.display==="none"?"block":"none";
}

month.onchange = render;
render();

if("serviceWorker" in navigator){
    navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>
